using Microsoft.AspNetCore.Mvc;
using System.Threading.Tasks;

[ApiController]
[Route("api/[controller]")]
public class VulnerabilityController : ControllerBase
{
    private readonly ZapScannerService _zapService;

    public VulnerabilityController(ZapScannerService zapService)
    {
        _zapService = zapService;
    }

    [HttpGet("scan")]
    public async Task<IActionResult> GetZapAlerts()
    {
        var alerts = await _zapService.GetAlertsAsync();
        return Ok(alerts);
    }
	
	[HttpPost("scan")]
	public async Task<IActionResult> TriggerScan([FromBody] string targetUrl)
	{
    	await _zapService.StartScanAsync(targetUrl);
    	var alerts = await _zapService.GetAlertsAsync();
    	return Ok(alerts);
	}
	
	[HttpGet("cves")]
	public async Task<IActionResult> GetCves([FromQuery] string keyword)
	{
		var results = await _zapService.GetCvesForKeywordAsync(keyword);
		return Ok(results);
	}
}